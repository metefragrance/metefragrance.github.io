<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>Mete Fragrance Admin</title>
<style>
body{background:#0e0e0e;color:#fff;font-family:Arial;padding:24px}
input,button{width:100%;padding:10px;margin:8px 0;background:#000;color:#fff;border:1px solid #333}
button{cursor:pointer}
pre{background:#000;padding:12px;white-space:pre-wrap}
.box{border:1px solid #222;padding:12px;margin-bottom:16px}
.count{font-size:20px;font-weight:bold}
</style>
</head>

<body>

<!-- DASHBOARD -->
<div class="box">
  <h3>ðŸ“Š Dashboard</h3>
  <div>Toplam ÃœrÃ¼n: <span class="count" id="total">â€“</span></div>
  <div>Shopier Linkli ÃœrÃ¼n: <span class="count" id="shopier">â€“</span></div>
</div>

<!-- FORM -->
<div class="box">
  <h3>âž• ÃœrÃ¼n Ekle</h3>
  <input id="t" placeholder="GitHub Token (classic)">
  <input id="n" placeholder="Ad">
  <input id="p" placeholder="Fiyat">
  <input id="i" placeholder="Resim URL">
  <input id="l" placeholder="Shopier Link">
  <button id="b">GÃ–NDER</button>
</div>

<pre id="log">HazÄ±r</pre>

<script>
const OWNER="metefragrance";
const REPO="metefragrance.github.io";

/* DASHBOARD VERÄ°LERÄ° */
fetch("/index.html")
  .then(r=>r.text())
  .then(html=>{
    const doc = new DOMParser().parseFromString(html,"text/html");
    const cards = [...doc.querySelectorAll(".card")];
    document.getElementById("total").textContent = cards.length;
    document.getElementById("shopier").textContent =
      cards.filter(c => c.href && c.href.includes("shopier.com")).length;
  });

/* ÃœRÃœN EKLE */
b.onclick = async () => {
  const url = `https://api.github.com/repos/${OWNER}/${REPO}/dispatches`;

  const res = await fetch(url,{
    method:"POST",
    headers:{
      "Accept":"application/vnd.github+json",
      "Content-Type":"application/json",
      "Authorization":"Bearer " + t.value.trim(),
      "X-GitHub-Api-Version":"2022-11-28"
    },
    body: JSON.stringify({
      event_type:"add",
      client_payload:{
        name:n.value,
        price:p.value,
        img:i.value,
        link:l.value   // ðŸ”´ DÄ°REKT SHOPIER LINK
      }
    })
  });

  log.textContent =
    "STATUS: " + res.status + "\n" +
    ((await res.text()) || "(204 ise normal)");
};
</script>

</body>
</html>
