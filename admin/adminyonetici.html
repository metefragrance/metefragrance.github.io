<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>Mete Fragrance â€“ Admin</title>

<style>
body{
  background:#0e0e0e;
  color:#fff;
  font-family:Arial;
  padding:24px
}
input,button,label{
  width:100%;
  padding:10px;
  margin:8px 0;
  background:#000;
  color:#fff;
  border:1px solid #333
}
button{cursor:pointer}
pre{
  background:#000;
  padding:12px;
  white-space:pre-wrap
}
.box{
  border:1px solid #222;
  padding:14px;
  margin-bottom:20px
}
.count{
  font-size:20px;
  font-weight:bold
}
hr{
  border:0;
  border-top:1px solid #222;
  margin:20px 0
}
</style>
</head>

<body>

<!-- DASHBOARD -->
<div class="box">
  <h3>ğŸ“Š Dashboard</h3>
  <div>Toplam ÃœrÃ¼n: <span class="count" id="total">â€“</span></div>
</div>

<!-- EKLE -->
<div class="box">
  <h3>â• ÃœrÃ¼n Ekle</h3>
  <input id="t" placeholder="GitHub Token (classic)">
  <input id="n" placeholder="Ad">
  <input id="p" placeholder="Fiyat">
  <input id="i" placeholder="Resim URL">
  <input id="l" placeholder="Shopier Link">
  <label>
    <input type="checkbox" id="badge"> ÃœrÃ¼n Rozeti (Yeni / Combo)
  </label>
  <button id="add">ÃœRÃœN EKLE</button>
</div>

<!-- SÄ°L -->
<div class="box">
  <h3>ğŸ—‘ï¸ ÃœrÃ¼n Sil</h3>
  <input id="del" placeholder="Silinecek Shopier Link">
  <button id="delBtn">ÃœRÃœNÃœ SÄ°L</button>
</div>

<pre id="log">HazÄ±r</pre>

<script>
const OWNER="metefragrance";
const REPO="metefragrance.github.io";

/* DASHBOARD */
fetch("/index.html")
.then(r=>r.text())
.then(html=>{
  const doc = new DOMParser().parseFromString(html,"text/html");
  const cards = [...doc.querySelectorAll(".card")];
  document.getElementById("total").textContent = cards.length;
  document.getElementById("shopier").textContent =
    cards.filter(c => c.href && c.href.includes("shopier.com")).length;
});

/* EKLE */
add.onclick = async () => {
  const res = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/dispatches`,
    {
      method:"POST",
      headers:{
        "Accept":"application/vnd.github+json",
        "Content-Type":"application/json",
        "Authorization":"Bearer " + t.value.trim()
      },
      body: JSON.stringify({
        event_type:"add",
        client_payload:{
          name:n.value,
          price:p.value,
          img:i.value,
          link:l.value,
          badge: badge.checked ? "Yeni" : ""
        }
      })
    }
  );

  log.textContent =
    "ADD STATUS: " + res.status + "\n" +
    ((await res.text()) || "(204 ise normal)");
};

/* SÄ°L */
delBtn.onclick = async () => {
  const res = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/dispatches`,
    {
      method:"POST",
      headers:{
        "Accept":"application/vnd.github+json",
        "Content-Type":"application/json",
        "Authorization":"Bearer " + t.value.trim()
      },
      body: JSON.stringify({
        event_type:"delete",
        client_payload:{ link: del.value }
      })
    }
  );

  log.textContent =
    "DELETE STATUS: " + res.status + "\n" +
    ((await res.text()) || "(204 ise normal)");
};
</script>

</body>
</html>
