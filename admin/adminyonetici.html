<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>Mete Fragrance ‚Äì Admin</title>

<style>
body{background:#0e0e0e;color:#fff;font-family:Arial;padding:24px}
input,button,select,label{
  width:100%;
  padding:10px;
  margin:8px 0;
  background:#000;
  color:#fff;
  border:1px solid #333
}
button{cursor:pointer}
pre{background:#000;padding:12px;white-space:pre-wrap}
.box{border:1px solid #222;padding:14px;margin-bottom:20px}
.count{font-size:20px;font-weight:bold}
</style>
</head>

<body>

<!-- DASHBOARD -->
<div class="box">
  <h3>üìä Dashboard</h3>
  <div>Toplam √úr√ºn: <span class="count" id="total">‚Äì</span></div>
  <div>Shopier Linkli: <span class="count" id="shopier">‚Äì</span></div>
</div>

<!-- EKLE -->
<div class="box">
  <h3>‚ûï √úr√ºn Ekle</h3>
  <input id="t" placeholder="GitHub Token (classic)">
  <input id="n" placeholder="Ad">
  <input id="p" placeholder="Fiyat">
  <input id="i" placeholder="Resim URL">
  <input id="l" placeholder="Shopier Link">
  <label><input type="checkbox" id="badge"> √úr√ºn Rozeti (Yeni)</label>
  <button id="add">√úR√úN EKLE</button>
</div>

<!-- Sƒ∞L -->
<div class="box">
  <h3>üóëÔ∏è √úr√ºn Sil</h3>
  <select id="productSelect">
    <option value="">√úr√ºn y√ºkleniyor‚Ä¶</option>
  </select>
  <button id="delBtn">SE√áƒ∞LEN √úR√úN√ú Sƒ∞L</button>
</div>

<pre id="log">Hazƒ±r</pre>

<script>
const OWNER="metefragrance";
const REPO="metefragrance.github.io";

/* √úR√úNLERƒ∞ Y√úKLE */
async function loadProducts(){
  const html = await fetch("/index.html").then(r=>r.text());
  const doc = new DOMParser().parseFromString(html,"text/html");
  const cards = [...doc.querySelectorAll(".card")];

  total.textContent = cards.length;
  shopier.textContent = cards.filter(c=>c.href.includes("shopier.com")).length;

  productSelect.innerHTML = "";
  cards.forEach(c=>{
    const opt = document.createElement("option");
    opt.value = c.href;
    opt.textContent = c.querySelector(".title")?.innerText || c.href;
    productSelect.appendChild(opt);
  });

  if(!cards.length){
    productSelect.innerHTML = `<option>√úr√ºn yok</option>`;
  }
}
loadProducts();

/* EKLE */
add.onclick = async () => {
  const res = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/dispatches`,
    {
      method:"POST",
      headers:{
        "Accept":"application/vnd.github+json",
        "Content-Type":"application/json",
        "Authorization":"Bearer " + t.value.trim()
      },
      body: JSON.stringify({
        event_type:"add",
        client_payload:{
          name:n.value,
          price:p.value,
          img:i.value,
          link:l.value,
          badge: badge.checked ? "Yeni" : ""
        }
      })
    }
  );
  log.textContent = "ADD STATUS: "+res.status;
};

/* Sƒ∞L */
delBtn.onclick = async () => {
  if(!productSelect.value){
    alert("√úr√ºn se√ß");
    return;
  }

  const res = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/dispatches`,
    {
      method:"POST",
      headers:{
        "Accept":"application/vnd.github+json",
        "Content-Type":"application/json",
        "Authorization":"Bearer " + t.value.trim()
      },
      body: JSON.stringify({
        event_type:"delete",
        client_payload:{ link: productSelect.value }
      })
    }
  );

  log.textContent = "DELETE STATUS: "+res.status;
  setTimeout(loadProducts, 1500);
};
</script>

</body>
</html>
