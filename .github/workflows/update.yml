name: Update Products

on:
  repository_dispatch:
    types: [add, delete]

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: main
          persist-credentials: true

      - name: Show status before
        run: |
          echo "=== BEFORE ==="
          git status
          ls -la

      - name: Run update script
        run: node update.js

      - name: Show status after
        run: |
          echo "=== AFTER ==="
          git status
          echo "---- tail index.html ----"
          tail -n 20 index.html

      - name: Commit and push
        run: |
          git config user.name "mete-bot"
          git config user.email "mete-bot@users.noreply.github.com"

          # ðŸ”´ KRÄ°TÄ°K SATIR
          git add -A

          git status

          # deÄŸiÅŸiklik yoksa hata vermesin
          git commit -m "Ã¼rÃ¼n gÃ¼ncellendi $(date +%s)" || true

          git push origin main
